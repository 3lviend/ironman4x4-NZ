<% @layout_fit_my_4x4 = 'above_heading' %>

<% if @this_category.present? %>
<% breadcrumb :category, @this_category %>
<% end %>

<% [:page_header, :title, :open_graph_title].each { |t| content_for t, @this_category.name if @this_category.present? } %>

<% content_for :body do %>
<% cache(@this_category) do %>
<%= render :partial => 'refinery/ironman/categories/filters', :locals => {category: @category, subcategory: @subcategory, sub_subcategory: @sub_subcategory} %>

<% if @products.present? and @products.empty? %>
  <p><%= t('.no_products_found') %></p>
<% end %>

<% if @products.present? %>
<ul id="page-product-list" class="clearfix">
<% @products.each do |product| %>
  <li class="product-container col-lg-3 col-md-4 col-sm-6 col-xs-12">
    <% if @category.present? and @subcategory.present? and @sub_subcategory.present? %>
    <% url = refinery.products_sub_subcategory_product_path(@sub_subcategory, @subcategory, @category, product) %>
    <% elsif @category.present? and @subcategory.present? %>
    <% url = refinery.products_subcategory_product_path(@subcategory, @category, product) %>
    <% elsif @category.present? %>
    <% url = refinery.products_category_product_path(@category, product) %>
    <% else %>
    <% url = refinery.ironman_products_path %>
    <% end %>

    <div class="product">
      <div class="photo"><!--
        --><%= if product.thumbnail_image.present? then image_tag product.thumbnail_image.thumbnail(geometry: "302x193").url else image_tag 'product_list_photo_default.jpg' end %><!--
      --></div>
      <div class="content">
        <h3><%= product.name %></h3>
        <div class="product_no"><%= product.product_no %></div>
        <% if product.price.present? %>
        <div class="price"><%= number_to_currency product.price %> <span class="inc_gst"><%= t('.inc_gst') %></span></div>
        <% end %>
        <div class="description">
          <% if product.short_description.present? %>
          <%= product.short_description %>
          <% else %>
          <%= t('.default_product_description') %>
          <% end %>
        </div>
        <div class="buttons clearfix">
          <div class="view-product col-sm-6">
            <%= link_to t('.buttons.view_product'), url, class: 'btn btn-primary btn-block' %>
          </div>
          <div class="add-to-wishlist col-sm-6">
            <%= button_tag t('.buttons.add_to_wishlist'), class: 'btn btn-primary btn-block' %>
          </div>
        </div>
      </div>
    </div>
  </li>
<% end %>
</ul>
<% end %>
<% end %>
<% end %>

<%= render '/refinery/content_page' %>
