<% if @this_category.present? %>
  <% cache_key = [@this_category] %>
<% else %>
  <% cache_key = [] %>
<% end %>

<% if @vehicle_filter.present? %>
  <% cache_key = cache_key.push @vehicle_filter %>
<% end %>

<% cache(cache_key) do %>
<% if @category.present? %>
  <%= render :partial => 'refinery/ironman/categories/filters', :locals => {category: @category, subcategory: @subcategory, sub_subcategory: @sub_subcategory} %>
<% end %>

<% if not @products.present? %>
  <% if @vehicle_filter.present? %>
  <p><%= t('.no_products_found_with_filter_applied') %></p>
  <% else %>
  <p><%= t('.no_products_found') %></p>
  <% end %>
<% end %>

<% if @products.present? %>
<ul id="page-product-list" class="clearfix">
<% @products.each do |product| %>
  <li class="product-container col-lg-3 col-md-4 col-sm-6 col-xs-12">
    <% if @category.present? and @subcategory.present? and @sub_subcategory.present? %>
    <% url = refinery.products_sub_subcategory_product_path(@sub_subcategory, @subcategory, @category, product) %>
    <% elsif @category.present? and @subcategory.present? %>
    <% url = refinery.products_subcategory_product_path(@subcategory, @category, product) %>
    <% elsif @category.present? %>
    <% url = refinery.products_category_product_path(@category, product) %>
    <% else %>
    <% url = refinery.ironman_product_path(product) %>
    <% end %>

    <div class="product">
      <div class="photo" style="background-image: url('<%= if product.thumbnail_image.present? then product.thumbnail_image.thumbnail(geometry: "302x193").url else image_url 'product_list_photo_default.jpg' end %>')"></div>
      <div class="content">
        <h3><%= product.name %></h3>
        <div class="product_no"><%= product.product_no %></div>
        <% if product.price.present? %>
        <div class="price"><%= number_to_currency product.price %> <span class="inc_gst"><%= t('.inc_gst') %></span></div>
        <% end %>
        <div class="description">
          <% if product.short_description.present? %>
          <%= product.short_description %>
          <% else %>
          <%= t('.default_product_description') %>
          <% end %>
        </div>
        <div class="buttons clearfix">
          <div class="view-product col-sm-6">
            <%= link_to t('.buttons.view_product'), url, class: 'btn btn-primary btn-block' %>
          </div>
          <div class="add-to-wishlist col-sm-6">
            <%= button_tag t('.buttons.add_to_wishlist'), class: 'btn btn-primary btn-block btn-add-to-wishlist', :'data-product-id' => product.id %>
          </div>
        </div>
      </div>
    </div>
  </li>
<% end %>
</ul>
<% end %>
<% end %>
