<%
  vehicle_make = nil
  vehicle_model = nil
  vehicle_series = nil

  if params[:vehicle_1st_id].present? or params[:vehicle_2nd_id].present? or params[:vehicle_3rd_id].present?
    make_id = params[:vehicle_1st_id]
    model_id = params[:vehicle_2nd_id]
    series_id = params[:vehicle_3rd_id]

  elsif cookies[:fit_my_4x4].present?
    vehicle_filter = JSON.parse(cookies[:fit_my_4x4]).with_indifferent_access
    make_id = vehicle_filter[:vehicle_make_id]
    model_id = vehicle_filter[:vehicle_model_id]
    series_id = vehicle_filter[:vehicle_series_id]
  end

  vehicle_make = Refinery::Ironman::Vehicle.find(make_id) if make_id.present? and make_id != 0
  vehicle_model = Refinery::Ironman::Vehicle.find(model_id) if model_id.present? and model_id != 0
  vehicle_series = Refinery::Ironman::Vehicle.find(series_id) if series_id.present? and series_id != 0
%>

<div class="control first col-sm-3 col-md-2">
  <%= select_tag :vehicle_1st_id, options_from_collection_for_select(Refinery::Ironman::Vehicle.roots, 'id', 'name', (vehicle_make.id if vehicle_make.present?)), :prompt => t('.vehicle_make.prompt'), :class => 'form-control' %>
</div>

<div class="control col-sm-3 col-md-2">
  <%= select_tag :vehicle_2nd_id, options_from_collection_for_select(if vehicle_make.present? then vehicle_make.children else [] end, 'id', 'name', (vehicle_model.id if vehicle_model.present?)),
                 'data-option-dependent' => true,
                 'data-option-observed' => 'vehicle_1st_id',
                 'data-option-url' => '/vehicles/:vehicle_1st_id:/children.json',
                 'data-option-key-method' => :id,
                 'data-option-value-method' => :name,
                 :prompt => t('.vehicle_model.prompt'),
                 :class => 'form-control' %>
</div>

<div class="control last col-sm-3 col-md-2">
  <%= select_tag :vehicle_3rd_id, options_from_collection_for_select(if vehicle_model.present? then vehicle_model.children else [] end, 'id', 'name', (vehicle_series.id if vehicle_series.present?)),
                 'data-option-dependent' => true,
                 'data-option-observed' => 'vehicle_2nd_id',
                 'data-option-url' => '/vehicles/:vehicle_2nd_id:/children.json',
                 'data-option-key-method' => :id,
                 'data-option-value-method' => :name,
                 :prompt => t('.vehicle_series.prompt'),
                 :class => 'form-control' %>
</div>
